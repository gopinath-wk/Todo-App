<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Todo App </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5">
<div class="container">
  <h1 class="mb-4">Todo App </h1>
<button id="logoutBtn" class="btn btn-secondary mb-3">Logout</button>
  <form id="todoForm" class="mb-3">
    <div class="input-group">
      <input type="text" id="todoInput" class="form-control" placeholder="Enter todo" required>
      <button class="btn btn-primary" type="submit">Add</button>
    </div>
  </form>

  <ul id="todoList" class="list-group"></ul>
</div>

<script>
  const token = localStorage.getItem("token");
if (!token) window.location.href = "login.html";
const logoutBtn = document.getElementById("logoutBtn");
logoutBtn.addEventListener("click", () => {
  localStorage.removeItem("token");
  window.location.href = "login.html";
});

  const todoForm = document.getElementById("todoForm");
  const todoInput = document.getElementById("todoInput");
  const todoList = document.getElementById("todoList");

  const fetchTodos = async () => {
    const res = await fetch("/todos", {
    headers: { "Authorization": `Bearer ${token}` }
  });
    const todos = await res.json();
    todoList.innerHTML = "";
    todos.forEach(todo => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      li.innerHTML = `
        <span style="text-decoration:${todo.completed ? 'line-through' : 'none'}">${todo.text}</span>
        <div>
          <button class="btn btn-sm btn-success me-2" onclick="toggle('${todo._id}')">✓</button>
          <button class="btn btn-sm btn-danger" onclick="remove('${todo._id}')">✕</button>
        </div>
      `;
      todoList.appendChild(li);
    });
  };

  todoForm.addEventListener("submit", async e => {
    e.preventDefault();
    await fetch("/todos", {
    method: "POST",
    headers: { 
      "Content-Type": "application/json",
      "Authorization": `Bearer ${token}`
    },
      body: JSON.stringify({ text: todoInput.value })
    });
    todoInput.value = "";
    fetchTodos();
  });

  window.toggle = async _id => {
    await fetch(`/todos/${_id}`, { method: "put" ,method: "PUT", 
    headers: { "Authorization": `Bearer ${token}` } });
    fetchTodos();
  };

  window.remove = async _id => {
    await fetch(`/todos/${_id}`, { method: "DELETE" ,headers: { "Authorization": `Bearer ${token}` } });
    fetchTodos();
  };

  fetchTodos();
</script>
</body>
</html>
